#!/usr/bin/env node
var yt=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);import U from"fs";import V from"path";import $t from"os";import{WriteStream as xt}from"node:tty";import E,{stdin as Te,stdout as Pe}from"node:process";import*as K from"node:readline";import Ge from"node:readline";import St from"tty";import{Buffer as Et}from"node:buffer";import G from"node:path";import _e from"node:child_process";import It from"child_process";import Ct from"node:url";import Ot,{constants as Re}from"node:os";import Tt from"assert";import Pt from"events";import Gt from"buffer";import te from"stream";import _t from"util";import{OpenAIApi as Rt,Configuration as At}from"openai";var Ss=yt(Se=>{var I=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},k={},Nt={get exports(){return k},set exports(e){k=e}},kt="dotenv",jt="16.0.3",Lt="Loads environment variables from .env file",Bt="lib/main.js",Ft="lib/main.d.ts",Se={".":{require:"./lib/main.js",types:"./lib/main.d.ts",default:"./lib/main.js"},"./config":"./config.js","./config.js":"./config.js","./lib/env-options":"./lib/env-options.js","./lib/env-options.js":"./lib/env-options.js","./lib/cli-options":"./lib/cli-options.js","./lib/cli-options.js":"./lib/cli-options.js","./package.json":"./package.json"},Dt={"dts-check":"tsc --project tests/types/tsconfig.json",lint:"standard","lint-readme":"standard-markdown",pretest:"npm run lint && npm run dts-check",test:"tap tests/*.js --100 -Rspec",prerelease:"npm test",release:"standard-version"},Mt={type:"git",url:"git://github.com/motdotla/dotenv.git"},Ut=["dotenv","env",".env","environment","variables","config","settings"],Vt="README.md",Kt="BSD-2-Clause",qt={"@types/node":"^17.0.9",decache:"^4.6.1",dtslint:"^3.7.0",sinon:"^12.0.1",standard:"^16.0.4","standard-markdown":"^7.1.0","standard-version":"^9.3.2",tap:"^15.1.6",tar:"^6.1.11",typescript:"^4.5.4"},Wt={node:">=12"},Ht={name:kt,version:jt,description:Lt,main:Bt,types:Ft,exports:Se,scripts:Dt,repository:Mt,keywords:Ut,readmeFilename:Vt,license:Kt,devDependencies:qt,engines:Wt};const zt=U,Ae=V,Xt=$t,Yt=Ht,Jt=Yt.version,Qt=/(?:^|^)\s*(?:export\s+)?([\w.-]+)(?:\s*=\s*?|:\s+?)(\s*'(?:\\'|[^'])*'|\s*"(?:\\"|[^"])*"|\s*`(?:\\`|[^`])*`|[^#\r\n]+)?\s*(?:#.*)?(?:$|$)/mg;function Zt(e){const t={};let n=e.toString();n=n.replace(/\r\n?/mg,`
`);let r;for(;(r=Qt.exec(n))!=null;){const i=r[1];let s=r[2]||"";s=s.trim();const o=s[0];s=s.replace(/^(['"`])([\s\S]*)\1$/mg,"$2"),o==='"'&&(s=s.replace(/\\n/g,`
`),s=s.replace(/\\r/g,"\r")),t[i]=s}return t}function ne(e){console.log(`[dotenv@${Jt}][DEBUG] ${e}`)}function en(e){return e[0]==="~"?Ae.join(Xt.homedir(),e.slice(1)):e}function tn(e){let t=Ae.resolve(process.cwd(),".env"),n="utf8";const r=Boolean(e&&e.debug),i=Boolean(e&&e.override);e&&(e.path!=null&&(t=en(e.path)),e.encoding!=null&&(n=e.encoding));try{const s=q.parse(zt.readFileSync(t,{encoding:n}));return Object.keys(s).forEach(function(o){Object.prototype.hasOwnProperty.call(process.env,o)?(i===!0&&(process.env[o]=s[o]),r&&ne(i===!0?`"${o}" is already defined in \`process.env\` and WAS overwritten`:`"${o}" is already defined in \`process.env\` and was NOT overwritten`)):process.env[o]=s[o]}),{parsed:s}}catch(s){return r&&ne(`Failed to load ${t} ${s.message}`),{error:s}}}const q={config:tn,parse:Zt};k.config=q.config,k.parse=q.parse,Nt.exports=q;const j={};process.env.DOTENV_CONFIG_ENCODING!=null&&(j.encoding=process.env.DOTENV_CONFIG_ENCODING),process.env.DOTENV_CONFIG_PATH!=null&&(j.path=process.env.DOTENV_CONFIG_PATH),process.env.DOTENV_CONFIG_DEBUG!=null&&(j.debug=process.env.DOTENV_CONFIG_DEBUG),process.env.DOTENV_CONFIG_OVERRIDE!=null&&(j.override=process.env.DOTENV_CONFIG_OVERRIDE);var nn=j;const rn=/^dotenv_config_(encoding|path|debug|override)=(.+)$/;var sn=function(t){return t.reduce(function(n,r){const i=r.match(rn);return i&&(n[i[1]]=i[2]),n},{})};(function(){k.config(Object.assign({},nn,sn(process.argv)))})();let C=!0;const _=typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{};let Ne=0;if(_.process&&_.process.env&&_.process.stdout){const{FORCE_COLOR:e,NODE_DISABLE_COLORS:t,NO_COLOR:n,TERM:r}=_.process.env;t||n||e==="0"?C=!1:e==="1"||e==="2"||e==="3"?C=!0:r==="dumb"?C=!1:"CI"in _.process.env&&["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","GITHUB_ACTIONS","BUILDKITE","DRONE"].some(i=>i in _.process.env)?C=!0:C=process.stdout.isTTY,C&&(Ne=r&&r.endsWith("-256color")?2:1)}let ke={enabled:C,supportLevel:Ne};function L(e,t,n=1){const r=`\x1B[${e}m`,i=`\x1B[${t}m`,s=new RegExp(`\\x1b\\[${t}m`,"g");return o=>ke.enabled&&ke.supportLevel>=n?r+(""+o).replace(s,r)+i:""+o}const re=L(2,22),on=L(30,39),an=L(31,39),cn=L(32,39),un=L(46,49),se="\x1B",p=`${se}[`,ln="\x07",ie={to(e,t){return t?`${p}${t+1};${e+1}H`:`${p}${e+1}G`},move(e,t){let n="";return e<0?n+=`${p}${-e}D`:e>0&&(n+=`${p}${e}C`),t<0?n+=`${p}${-t}A`:t>0&&(n+=`${p}${t}B`),n},up:(e=1)=>`${p}${e}A`,down:(e=1)=>`${p}${e}B`,forward:(e=1)=>`${p}${e}C`,backward:(e=1)=>`${p}${e}D`,nextLine:(e=1)=>`${p}E`.repeat(e),prevLine:(e=1)=>`${p}F`.repeat(e),left:`${p}G`,hide:`${p}?25l`,show:`${p}?25h`,save:`${se}7`,restore:`${se}8`},dn={up:(e=1)=>`${p}S`.repeat(e),down:(e=1)=>`${p}T`.repeat(e)},fn={screen:`${p}2J`,up:(e=1)=>`${p}1J`.repeat(e),down:(e=1)=>`${p}J`.repeat(e),line:`${p}2K`,lineEnd:`${p}K`,lineStart:`${p}1K`,lines(e){let t="";for(let n=0;n<e;n++)t+=this.line+(n<e-1?ie.up():"");return e&&(t+=ie.left),t}};var b={cursor:ie,scroll:dn,erase:fn,beep:ln},c={},pn={get exports(){return c},set exports(e){c=e}};let mn=St,hn=!("NO_COLOR"in process.env||process.argv.includes("--no-color"))&&("FORCE_COLOR"in process.env||process.argv.includes("--color")||process.platform==="win32"||mn.isatty(1)&&process.env.TERM!=="dumb"||"CI"in process.env),d=(e,t,n=e)=>r=>{let i=""+r,s=i.indexOf(t,e.length);return~s?e+je(i,t,n,s)+t:e+i+t},je=(e,t,n,r)=>{let i=e.substring(0,r)+n,s=e.substring(r+t.length),o=s.indexOf(t);return~o?i+je(s,t,n,o):i+s},Le=(e=hn)=>({isColorSupported:e,reset:e?t=>`\x1B[0m${t}\x1B[0m`:String,bold:e?d("\x1B[1m","\x1B[22m","\x1B[22m\x1B[1m"):String,dim:e?d("\x1B[2m","\x1B[22m","\x1B[22m\x1B[2m"):String,italic:e?d("\x1B[3m","\x1B[23m"):String,underline:e?d("\x1B[4m","\x1B[24m"):String,inverse:e?d("\x1B[7m","\x1B[27m"):String,hidden:e?d("\x1B[8m","\x1B[28m"):String,strikethrough:e?d("\x1B[9m","\x1B[29m"):String,black:e?d("\x1B[30m","\x1B[39m"):String,red:e?d("\x1B[31m","\x1B[39m"):String,green:e?d("\x1B[32m","\x1B[39m"):String,yellow:e?d("\x1B[33m","\x1B[39m"):String,blue:e?d("\x1B[34m","\x1B[39m"):String,magenta:e?d("\x1B[35m","\x1B[39m"):String,cyan:e?d("\x1B[36m","\x1B[39m"):String,white:e?d("\x1B[37m","\x1B[39m"):String,gray:e?d("\x1B[90m","\x1B[39m"):String,bgBlack:e?d("\x1B[40m","\x1B[49m"):String,bgRed:e?d("\x1B[41m","\x1B[49m"):String,bgGreen:e?d("\x1B[42m","\x1B[49m"):String,bgYellow:e?d("\x1B[43m","\x1B[49m"):String,bgBlue:e?d("\x1B[44m","\x1B[49m"):String,bgMagenta:e?d("\x1B[45m","\x1B[49m"):String,bgCyan:e?d("\x1B[46m","\x1B[49m"):String,bgWhite:e?d("\x1B[47m","\x1B[49m"):String});pn.exports=Le(),c.createColors=Le;function gn(e,t){if(e===t)return;const n=e.split(`
`),r=t.split(`
`),i=[];for(let s=0;s<Math.max(n.length,r.length);s++)n[s]!==r[s]&&i.push(s);return i}const Be=Symbol("clack:cancel");function Fe(e){return e===Be}function W(e,t){e.isTTY&&e.setRawMode(t)}const vn=new Set(["up","down","left","right","space","enter"]);class De{constructor({render:t,input:n=Te,output:r=Pe,initialValue:i,...s},o=!0){this._track=!1,this._cursor=0,this.state="initial",this.error="",this.subscribers=new Map,this._prevFrame="",this.opts=s,this.onKeypress=this.onKeypress.bind(this),this.close=this.close.bind(this),this.render=this.render.bind(this),this._render=t.bind(this),this._track=o,this.input=n,this.output=r}prompt(t){const n=new xt(0);return n._write=(r,i,s)=>{this._track&&(this.value=this.rl.line.replace(/\t/g,""),this._cursor=this.rl.cursor,this.emit("value",this.value)),s()},this.input.pipe(n),this.rl=Ge.createInterface({input:this.input,output:n,tabSize:2,prompt:"",escapeCodeTimeout:50}),Ge.emitKeypressEvents(this.input,this.rl),this.rl.prompt(),t&&this.rl.write(t),this.input.on("keypress",this.onKeypress),W(this.input,!0),this.render(),new Promise((r,i)=>{this.once("submit",()=>{this.output.write(b.cursor.show),W(this.input,!1),r(this.value)}),this.once("cancel",()=>{this.output.write(b.cursor.show),W(this.input,!1),r(Be)})})}on(t,n){const r=this.subscribers.get(t)??[];r.push({cb:n}),this.subscribers.set(t,r)}once(t,n){const r=this.subscribers.get(t)??[];r.push({cb:n,once:!0}),this.subscribers.set(t,r)}emit(t,...n){const r=this.subscribers.get(t)??[],i=[];for(const s of r)s.cb(...n),s.once&&i.push(()=>r.splice(r.indexOf(s),1));for(const s of i)s()}unsubscribe(){this.subscribers.clear()}onKeypress(t,n){if(this.state==="error"&&(this.state="active"),n?.name&&vn.has(n.name)&&this.emit("cursor",n.name),t&&(t.toLowerCase()==="y"||t.toLowerCase()==="n")&&this.emit("confirm",t.toLowerCase()==="y"),n?.name==="return"){if("placeholder"in this.opts&&!this.value&&(this.value=this.opts.placeholder),this.opts.validate){const r=this.opts.validate(this.value);r&&(this.error=r,this.state="error",this.rl.write(this.value))}this.state!=="error"&&(this.state="submit")}t===""&&(this.state="cancel"),(this.state==="submit"||this.state==="cancel")&&this.emit("finalize"),this.render(),(this.state==="submit"||this.state==="cancel")&&this.close()}close(){this.input.removeListener("keypress",this.onKeypress),this.output.write(`
`),W(this.input,!1),this.rl.close(),this.emit(`${this.state}`,this.value),this.unsubscribe()}restoreCursor(){const t=this._prevFrame.split(`
`).length-1;this.output.write(b.cursor.move(-999,t*-1))}render(){const t=this._render(this)??"";if(t!==this._prevFrame){if(this.state==="initial")this.output.write(b.cursor.hide);else{const n=gn(this._prevFrame,t);if(this.restoreCursor(),n&&n?.length===1){const r=n[0];this.output.write(b.cursor.move(0,r)),this.output.write(b.erase.lines(1));const i=t.split(`
`);this.output.write(i[r]),this._prevFrame=t,this.output.write(b.cursor.move(0,i.length-r-1));return}else if(n&&n?.length>1){const r=n[0];this.output.write(b.cursor.move(0,r)),this.output.write(b.erase.down());const i=t.split(`
`).slice(r);this.output.write(i.join(`
`)),this._prevFrame=t;return}this.output.write(b.erase.down())}this.output.write(t),this.state==="initial"&&(this.state="active"),this._prevFrame=t}}}class bn extends De{constructor(t){super(t),this.valueWithCursor="",this.on("finalize",()=>{this.valueWithCursor=this.value}),this.on("value",()=>{if(this.cursor>=this.value.length)this.valueWithCursor=`${this.value}${c.inverse(c.hidden("_"))}`;else{const n=this.value.slice(0,this.cursor),r=this.value.slice(this.cursor);this.valueWithCursor=`${n}${c.inverse(r[0])}${r.slice(1)}`}})}get cursor(){return this._cursor}}class wn extends De{constructor(t){super(t,!1),this.cursor=0,this.options=t.options,this.cursor=this.options.findIndex(({value:n})=>n===t.initialValue),this.cursor===-1&&(this.cursor=0),this.changeValue(),this.on("cursor",n=>{switch(n){case"left":case"up":this.cursor=this.cursor===0?this.options.length-1:this.cursor-1;break;case"down":case"right":this.cursor=this.cursor===this.options.length-1?0:this.cursor+1;break}this.changeValue()})}get _value(){return this.options[this.cursor]}changeValue(){this.value=this._value.value}}function yn({input:e=Te,output:t=Pe,overwrite:n=!0,hideCursor:r=!0}={}){const i=K.createInterface({input:e,output:t,prompt:"",tabSize:1});K.emitKeypressEvents(e,i),e.isTTY&&e.setRawMode(!0);const s=(o,{name:a})=>{if(String(o)===""&&process.exit(0),!n)return;let u=a==="return"?0:-1,l=a==="return"?-1:0;K.moveCursor(t,u,l,()=>{K.clearLine(t,1,()=>{e.once("keypress",s)})})};return r&&process.stdout.write(b.cursor.hide),e.once("keypress",s),()=>{e.off("keypress",s),r&&process.stdout.write(b.cursor.show),i.close()}}const Me=e=>{switch(e){case"initial":case"active":return c.cyan("\u25CF");case"cancel":return c.red("\u25A0");case"error":return c.yellow("\u25B2");case"submit":return c.green("\u25CB")}},$n="\u250C",w="\u2502",H="\u2514",xn=e=>new bn({validate:e.validate,placeholder:e.placeholder,render(){const t=`${c.gray(w)}
${Me(this.state)}  ${e.message}
`,n=e.placeholder?c.inverse(e.placeholder[0])+c.dim(e.placeholder.slice(1)):c.inverse(c.hidden("_")),r=this.value?this.valueWithCursor:n;switch(this.state){case"error":return`${t.trim()}
${c.yellow(w)}  ${r}
${c.yellow(H)}  ${c.yellow(this.error)}
`;case"submit":return`${t}${c.gray(w)}  ${c.dim(this.value)}`;case"cancel":return`${t}${c.gray(w)}  ${c.strikethrough(c.dim(this.value))}${this.value.trim()?`
`+c.gray(w):""}`;default:return`${t}${c.cyan(w)}  ${r}
${c.cyan(H)}
`}}}).prompt(e.initial),Sn=e=>{const t=(n,r)=>{const i=n.label??n.value;return r==="active"?`${c.green("\u25CF")} ${i} ${n.hint?c.dim(`(${n.hint})`):""}`:r==="selected"?`${c.dim(i)}`:r==="cancelled"?`${c.strikethrough(c.dim(i))}`:`${c.dim("\u25CB")} ${c.dim(i)}`};return new wn({options:e.options,initialValue:e.initialValue,render(){const n=`${c.gray(w)}
${Me(this.state)}  ${e.message}
`;switch(this.state){case"submit":return`${n}${c.gray(w)}  ${t(this.options[this.cursor],"selected")}`;case"cancel":return`${n}${c.gray(w)}  ${t(this.options[this.cursor],"cancelled")}
${c.gray(w)}`;default:return`${n}${c.cyan(w)}  ${this.options.map((r,i)=>t(r,i===this.cursor?"active":"inactive")).join(`
${c.cyan(w)}  `)}
${c.cyan(H)}
`}}}).prompt()},En=(e="")=>{process.stdout.write(`${c.gray($n)}  ${e}
`)},Ue=(e="")=>{process.stdout.write(`${c.gray(w)}
${c.gray(H)}  ${e}

`)},In=["\u25D2","\u25D0","\u25D3","\u25D1"],Ve=()=>{let e,t;const n=In,r=80;return{start(i=""){i=i.replace(/\.?\.?\.$/,""),e=yn(),process.stdout.write(`${c.gray(w)}
${c.magenta("\u25CB")}  ${i}
`);let s=0,o=0;t=setInterval(()=>{let a=n[s];process.stdout.write(b.cursor.move(-999,-1)),process.stdout.write(`${c.magenta(a)}  ${i}${Math.floor(o)>=1?".".repeat(Math.floor(o)).slice(0,3):""}   
`),s=s===n.length-1?0:s+1,o=o===n.length?0:o+.125},r)},stop(i=""){process.stdout.write(b.cursor.move(-999,-2)),process.stdout.write(b.erase.down(2)),clearInterval(t),process.stdout.write(`${c.gray(w)}
${c.green("\u25CB")}  ${i}
`),e()}}};var O={},Cn={get exports(){return O},set exports(e){O=e}},oe,Ke;function On(){if(Ke)return oe;Ke=1,oe=r,r.sync=i;var e=U;function t(s,o){var a=o.pathExt!==void 0?o.pathExt:process.env.PATHEXT;if(!a||(a=a.split(";"),a.indexOf("")!==-1))return!0;for(var u=0;u<a.length;u++){var l=a[u].toLowerCase();if(l&&s.substr(-l.length).toLowerCase()===l)return!0}return!1}function n(s,o,a){return!s.isSymbolicLink()&&!s.isFile()?!1:t(o,a)}function r(s,o,a){e.stat(s,function(u,l){a(u,u?!1:n(l,s,o))})}function i(s,o){return n(e.statSync(s),s,o)}return oe}var ae,qe;function Tn(){if(qe)return ae;qe=1,ae=t,t.sync=n;var e=U;function t(s,o,a){e.stat(s,function(u,l){a(u,u?!1:r(l,o))})}function n(s,o){return r(e.statSync(s),o)}function r(s,o){return s.isFile()&&i(s,o)}function i(s,o){var a=s.mode,u=s.uid,l=s.gid,m=o.uid!==void 0?o.uid:process.getuid&&process.getuid(),y=o.gid!==void 0?o.gid:process.getgid&&process.getgid(),h=parseInt("100",8),v=parseInt("010",8),$=parseInt("001",8),x=h|v,S=a&$||a&v&&l===y||a&h&&u===m||a&x&&m===0;return S}return ae}var z;process.platform==="win32"||I.TESTING_WINDOWS?z=On():z=Tn();var Pn=ce;ce.sync=Gn;function ce(e,t,n){if(typeof t=="function"&&(n=t,t={}),!n){if(typeof Promise!="function")throw new TypeError("callback not provided");return new Promise(function(r,i){ce(e,t||{},function(s,o){s?i(s):r(o)})})}z(e,t||{},function(r,i){r&&(r.code==="EACCES"||t&&t.ignoreErrors)&&(r=null,i=!1),n(r,i)})}function Gn(e,t){try{return z.sync(e,t||{})}catch(n){if(t&&t.ignoreErrors||n.code==="EACCES")return!1;throw n}}const R=process.platform==="win32"||process.env.OSTYPE==="cygwin"||process.env.OSTYPE==="msys",We=V,_n=R?";":":",He=Pn,ze=e=>Object.assign(new Error(`not found: ${e}`),{code:"ENOENT"}),Xe=(e,t)=>{const n=t.colon||_n,r=e.match(/\//)||R&&e.match(/\\/)?[""]:[...R?[process.cwd()]:[],...(t.path||process.env.PATH||"").split(n)],i=R?t.pathExt||process.env.PATHEXT||".EXE;.CMD;.BAT;.COM":"",s=R?i.split(n):[""];return R&&e.indexOf(".")!==-1&&s[0]!==""&&s.unshift(""),{pathEnv:r,pathExt:s,pathExtExe:i}},Ye=(e,t,n)=>{typeof t=="function"&&(n=t,t={}),t||(t={});const{pathEnv:r,pathExt:i,pathExtExe:s}=Xe(e,t),o=[],a=l=>new Promise((m,y)=>{if(l===r.length)return t.all&&o.length?m(o):y(ze(e));const h=r[l],v=/^".*"$/.test(h)?h.slice(1,-1):h,$=We.join(v,e),x=!v&&/^\.[\\\/]/.test(e)?e.slice(0,2)+$:$;m(u(x,l,0))}),u=(l,m,y)=>new Promise((h,v)=>{if(y===i.length)return h(a(m+1));const $=i[y];He(l+$,{pathExt:s},(x,S)=>{if(!x&&S)if(t.all)o.push(l+$);else return h(l+$);return h(u(l,m,y+1))})});return n?a(0).then(l=>n(null,l),n):a(0)},Rn=(e,t)=>{t=t||{};const{pathEnv:n,pathExt:r,pathExtExe:i}=Xe(e,t),s=[];for(let o=0;o<n.length;o++){const a=n[o],u=/^".*"$/.test(a)?a.slice(1,-1):a,l=We.join(u,e),m=!u&&/^\.[\\\/]/.test(e)?e.slice(0,2)+l:l;for(let y=0;y<r.length;y++){const h=m+r[y];try{if(He.sync(h,{pathExt:i}))if(t.all)s.push(h);else return h}catch{}}}if(t.all&&s.length)return s;if(t.nothrow)return null;throw ze(e)};var An=Ye;Ye.sync=Rn;var X={},Nn={get exports(){return X},set exports(e){X=e}};const Je=(e={})=>{const t=e.env||process.env;return(e.platform||process.platform)!=="win32"?"PATH":Object.keys(t).reverse().find(r=>r.toUpperCase()==="PATH")||"Path"};Nn.exports=Je,X.default=Je;const Qe=V,kn=An,jn=X;function Ze(e,t){const n=e.options.env||process.env,r=process.cwd(),i=e.options.cwd!=null,s=i&&process.chdir!==void 0&&!process.chdir.disabled;if(s)try{process.chdir(e.options.cwd)}catch{}let o;try{o=kn.sync(e.command,{path:n[jn({env:n})],pathExt:t?Qe.delimiter:void 0})}catch{}finally{s&&process.chdir(r)}return o&&(o=Qe.resolve(i?e.options.cwd:"",o)),o}function Ln(e){return Ze(e)||Ze(e,!0)}var Bn=Ln,ue={};const le=/([()\][%!^"`<>&|;, *?])/g;function Fn(e){return e=e.replace(le,"^$1"),e}function Dn(e,t){return e=`${e}`,e=e.replace(/(\\*)"/g,'$1$1\\"'),e=e.replace(/(\\*)$/,"$1$1"),e=`"${e}"`,e=e.replace(le,"^$1"),t&&(e=e.replace(le,"^$1")),e}ue.command=Fn,ue.argument=Dn;var Mn=/^#!(.*)/;const Un=Mn;var Vn=(e="")=>{const t=e.match(Un);if(!t)return null;const[n,r]=t[0].replace(/#! ?/,"").split(" "),i=n.split("/").pop();return i==="env"?r:r?`${i} ${r}`:i};const de=U,Kn=Vn;function qn(e){const n=Buffer.alloc(150);let r;try{r=de.openSync(e,"r"),de.readSync(r,n,0,150,0),de.closeSync(r)}catch{}return Kn(n.toString())}var Wn=qn;const Hn=V,et=Bn,tt=ue,zn=Wn,Xn=process.platform==="win32",Yn=/\.(?:com|exe)$/i,Jn=/node_modules[\\/].bin[\\/][^\\/]+\.cmd$/i;function Qn(e){e.file=et(e);const t=e.file&&zn(e.file);return t?(e.args.unshift(e.file),e.command=t,et(e)):e.file}function Zn(e){if(!Xn)return e;const t=Qn(e),n=!Yn.test(t);if(e.options.forceShell||n){const r=Jn.test(t);e.command=Hn.normalize(e.command),e.command=tt.command(e.command),e.args=e.args.map(s=>tt.argument(s,r));const i=[e.command].concat(e.args).join(" ");e.args=["/d","/s","/c",`"${i}"`],e.command=process.env.comspec||"cmd.exe",e.options.windowsVerbatimArguments=!0}return e}function er(e,t,n){t&&!Array.isArray(t)&&(n=t,t=null),t=t?t.slice(0):[],n=Object.assign({},n);const r={command:e,args:t,options:n,file:void 0,original:{command:e,args:t}};return n.shell?r:Zn(r)}var tr=er;const fe=process.platform==="win32";function pe(e,t){return Object.assign(new Error(`${t} ${e.command} ENOENT`),{code:"ENOENT",errno:"ENOENT",syscall:`${t} ${e.command}`,path:e.command,spawnargs:e.args})}function nr(e,t){if(!fe)return;const n=e.emit;e.emit=function(r,i){if(r==="exit"){const s=nt(i,t);if(s)return n.call(e,"error",s)}return n.apply(e,arguments)}}function nt(e,t){return fe&&e===1&&!t.file?pe(t.original,"spawn"):null}function rr(e,t){return fe&&e===1&&!t.file?pe(t.original,"spawnSync"):null}var sr={hookChildProcess:nr,verifyENOENT:nt,verifyENOENTSync:rr,notFoundError:pe};const rt=It,me=tr,he=sr;function st(e,t,n){const r=me(e,t,n),i=rt.spawn(r.command,r.args,r.options);return he.hookChildProcess(i,r),i}function ir(e,t,n){const r=me(e,t,n),i=rt.spawnSync(r.command,r.args,r.options);return i.error=i.error||he.verifyENOENTSync(i.status,r),i}Cn.exports=st,O.spawn=st,O.sync=ir,O._parse=me,O._enoent=he;function or(e){const t=typeof e=="string"?`
`:`
`.charCodeAt(),n=typeof e=="string"?"\r":"\r".charCodeAt();return e[e.length-1]===t&&(e=e.slice(0,-1)),e[e.length-1]===n&&(e=e.slice(0,-1)),e}function it(e={}){const{env:t=process.env,platform:n=process.platform}=e;return n!=="win32"?"PATH":Object.keys(t).reverse().find(r=>r.toUpperCase()==="PATH")||"Path"}function ar(e={}){const{cwd:t=E.cwd(),path:n=E.env[it()],execPath:r=E.execPath}=e;let i;const s=t instanceof URL?Ct.fileURLToPath(t):t;let o=G.resolve(s);const a=[];for(;i!==o;)a.push(G.join(o,"node_modules/.bin")),i=o,o=G.resolve(o,"..");return a.push(G.resolve(s,r,"..")),[...a,n].join(G.delimiter)}function cr({env:e=E.env,...t}={}){e={...e};const n=it({env:e});return t.path=e[n],e[n]=ar(t),e}const ur=(e,t,n,r)=>{if(n==="length"||n==="prototype"||n==="arguments"||n==="caller")return;const i=Object.getOwnPropertyDescriptor(e,n),s=Object.getOwnPropertyDescriptor(t,n);!lr(i,s)&&r||Object.defineProperty(e,n,s)},lr=function(e,t){return e===void 0||e.configurable||e.writable===t.writable&&e.enumerable===t.enumerable&&e.configurable===t.configurable&&(e.writable||e.value===t.value)},dr=(e,t)=>{const n=Object.getPrototypeOf(t);n!==Object.getPrototypeOf(e)&&Object.setPrototypeOf(e,n)},fr=(e,t)=>`/* Wrapped ${e}*/
${t}`,pr=Object.getOwnPropertyDescriptor(Function.prototype,"toString"),mr=Object.getOwnPropertyDescriptor(Function.prototype.toString,"name"),hr=(e,t,n)=>{const r=n===""?"":`with ${n.trim()}() `,i=fr.bind(null,r,t.toString());Object.defineProperty(i,"name",mr),Object.defineProperty(e,"toString",{...pr,value:i})};function gr(e,t,{ignoreNonConfigurable:n=!1}={}){const{name:r}=e;for(const i of Reflect.ownKeys(t))ur(e,t,i,n);return dr(e,t),hr(e,t,r),e}const Y=new WeakMap,ot=(e,t={})=>{if(typeof e!="function")throw new TypeError("Expected a function");let n,r=0;const i=e.displayName||e.name||"<anonymous>",s=function(...o){if(Y.set(s,++r),r===1)n=e.apply(this,o),e=null;else if(t.throw===!0)throw new Error(`Function \`${i}\` can only be called once`);return n};return gr(s,e),Y.set(s,r),s};ot.callCount=e=>{if(!Y.has(e))throw new Error(`The given function \`${e.name}\` is not wrapped by the \`onetime\` package`);return Y.get(e)};const vr=function(){const e=ct-at+1;return Array.from({length:e},br)},br=function(e,t){return{name:`SIGRT${t+1}`,number:at+t,action:"terminate",description:"Application-specific signal (realtime)",standard:"posix"}},at=34,ct=64,wr=[{name:"SIGHUP",number:1,action:"terminate",description:"Terminal closed",standard:"posix"},{name:"SIGINT",number:2,action:"terminate",description:"User interruption with CTRL-C",standard:"ansi"},{name:"SIGQUIT",number:3,action:"core",description:"User interruption with CTRL-\\",standard:"posix"},{name:"SIGILL",number:4,action:"core",description:"Invalid machine instruction",standard:"ansi"},{name:"SIGTRAP",number:5,action:"core",description:"Debugger breakpoint",standard:"posix"},{name:"SIGABRT",number:6,action:"core",description:"Aborted",standard:"ansi"},{name:"SIGIOT",number:6,action:"core",description:"Aborted",standard:"bsd"},{name:"SIGBUS",number:7,action:"core",description:"Bus error due to misaligned, non-existing address or paging error",standard:"bsd"},{name:"SIGEMT",number:7,action:"terminate",description:"Command should be emulated but is not implemented",standard:"other"},{name:"SIGFPE",number:8,action:"core",description:"Floating point arithmetic error",standard:"ansi"},{name:"SIGKILL",number:9,action:"terminate",description:"Forced termination",standard:"posix",forced:!0},{name:"SIGUSR1",number:10,action:"terminate",description:"Application-specific signal",standard:"posix"},{name:"SIGSEGV",number:11,action:"core",description:"Segmentation fault",standard:"ansi"},{name:"SIGUSR2",number:12,action:"terminate",description:"Application-specific signal",standard:"posix"},{name:"SIGPIPE",number:13,action:"terminate",description:"Broken pipe or socket",standard:"posix"},{name:"SIGALRM",number:14,action:"terminate",description:"Timeout or timer",standard:"posix"},{name:"SIGTERM",number:15,action:"terminate",description:"Termination",standard:"ansi"},{name:"SIGSTKFLT",number:16,action:"terminate",description:"Stack is empty or overflowed",standard:"other"},{name:"SIGCHLD",number:17,action:"ignore",description:"Child process terminated, paused or unpaused",standard:"posix"},{name:"SIGCLD",number:17,action:"ignore",description:"Child process terminated, paused or unpaused",standard:"other"},{name:"SIGCONT",number:18,action:"unpause",description:"Unpaused",standard:"posix",forced:!0},{name:"SIGSTOP",number:19,action:"pause",description:"Paused",standard:"posix",forced:!0},{name:"SIGTSTP",number:20,action:"pause",description:'Paused using CTRL-Z or "suspend"',standard:"posix"},{name:"SIGTTIN",number:21,action:"pause",description:"Background process cannot read terminal input",standard:"posix"},{name:"SIGBREAK",number:21,action:"terminate",description:"User interruption with CTRL-BREAK",standard:"other"},{name:"SIGTTOU",number:22,action:"pause",description:"Background process cannot write to terminal output",standard:"posix"},{name:"SIGURG",number:23,action:"ignore",description:"Socket received out-of-band data",standard:"bsd"},{name:"SIGXCPU",number:24,action:"core",description:"Process timed out",standard:"bsd"},{name:"SIGXFSZ",number:25,action:"core",description:"File too big",standard:"bsd"},{name:"SIGVTALRM",number:26,action:"terminate",description:"Timeout or timer",standard:"bsd"},{name:"SIGPROF",number:27,action:"terminate",description:"Timeout or timer",standard:"bsd"},{name:"SIGWINCH",number:28,action:"ignore",description:"Terminal window size changed",standard:"bsd"},{name:"SIGIO",number:29,action:"terminate",description:"I/O is available",standard:"other"},{name:"SIGPOLL",number:29,action:"terminate",description:"Watched event",standard:"other"},{name:"SIGINFO",number:29,action:"ignore",description:"Request for process information",standard:"other"},{name:"SIGPWR",number:30,action:"terminate",description:"Device running out of power",standard:"systemv"},{name:"SIGSYS",number:31,action:"core",description:"Invalid system call",standard:"other"},{name:"SIGUNUSED",number:31,action:"terminate",description:"Invalid system call",standard:"other"}],ut=function(){const e=vr();return[...wr,...e].map(yr)},yr=function({name:e,number:t,description:n,action:r,forced:i=!1,standard:s}){const{signals:{[e]:o}}=Re,a=o!==void 0;return{name:e,number:a?o:t,description:n,supported:a,action:r,forced:i,standard:s}},$r=function(){const e=ut();return Object.fromEntries(e.map(xr))},xr=function({name:e,number:t,description:n,supported:r,action:i,forced:s,standard:o}){return[e,{name:e,number:t,description:n,supported:r,action:i,forced:s,standard:o}]},Sr=$r(),Er=function(){const e=ut(),t=ct+1,n=Array.from({length:t},(r,i)=>Ir(i,e));return Object.assign({},...n)},Ir=function(e,t){const n=Cr(e,t);if(n===void 0)return{};const{name:r,description:i,supported:s,action:o,forced:a,standard:u}=n;return{[e]:{name:r,number:e,description:i,supported:s,action:o,forced:a,standard:u}}},Cr=function(e,t){const n=t.find(({name:r})=>Re.signals[r]===e);return n!==void 0?n:t.find(r=>r.number===e)};Er();const Or=({timedOut:e,timeout:t,errorCode:n,signal:r,signalDescription:i,exitCode:s,isCanceled:o})=>e?`timed out after ${t} milliseconds`:o?"was canceled":n!==void 0?`failed with ${n}`:r!==void 0?`was killed with ${r} (${i})`:s!==void 0?`failed with exit code ${s}`:"failed",lt=({stdout:e,stderr:t,all:n,error:r,signal:i,exitCode:s,command:o,escapedCommand:a,timedOut:u,isCanceled:l,killed:m,parsed:{options:{timeout:y}}})=>{s=s===null?void 0:s,i=i===null?void 0:i;const h=i===void 0?void 0:Sr[i].description,v=r&&r.code,x=`Command ${Or({timedOut:u,timeout:y,errorCode:v,signal:i,signalDescription:h,exitCode:s,isCanceled:l})}: ${o}`,S=Object.prototype.toString.call(r)==="[object Error]",D=S?`${x}
${r.message}`:x,M=[D,t,e].filter(Boolean).join(`
`);return S?(r.originalMessage=r.message,r.message=M):r=new Error(M),r.shortMessage=D,r.command=o,r.escapedCommand=a,r.exitCode=s,r.signal=i,r.signalDescription=h,r.stdout=e,r.stderr=t,n!==void 0&&(r.all=n),"bufferedData"in r&&delete r.bufferedData,r.failed=!0,r.timedOut=Boolean(u),r.isCanceled=l,r.killed=m&&!u,r},J=["stdin","stdout","stderr"],Tr=e=>J.some(t=>e[t]!==void 0),Pr=e=>{if(!e)return;const{stdio:t}=e;if(t===void 0)return J.map(r=>e[r]);if(Tr(e))throw new Error(`It's not possible to provide \`stdio\` in combination with one of ${J.map(r=>`\`${r}\``).join(", ")}`);if(typeof t=="string")return t;if(!Array.isArray(t))throw new TypeError(`Expected \`stdio\` to be of type \`string\` or \`Array\`, got \`${typeof t}\``);const n=Math.max(t.length,J.length);return Array.from({length:n},(r,i)=>t[i])};var A={},dt={get exports(){return A},set exports(e){A=e}},Q={},Gr={get exports(){return Q},set exports(e){Q=e}},ft;function _r(){return ft||(ft=1,function(e){e.exports=["SIGABRT","SIGALRM","SIGHUP","SIGINT","SIGTERM"],process.platform!=="win32"&&e.exports.push("SIGVTALRM","SIGXCPU","SIGXFSZ","SIGUSR2","SIGTRAP","SIGSYS","SIGQUIT","SIGIOT"),process.platform==="linux"&&e.exports.push("SIGIO","SIGPOLL","SIGPWR","SIGSTKFLT","SIGUNUSED")}(Gr)),Q}var f=I.process;const T=function(e){return e&&typeof e=="object"&&typeof e.removeListener=="function"&&typeof e.emit=="function"&&typeof e.reallyExit=="function"&&typeof e.listeners=="function"&&typeof e.kill=="function"&&typeof e.pid=="number"&&typeof e.on=="function"};if(!T(f))dt.exports=function(){return function(){}};else{var Rr=Tt,B=_r(),Ar=/^win/i.test(f.platform),Z=Pt;typeof Z!="function"&&(Z=Z.EventEmitter);var g;f.__signal_exit_emitter__?g=f.__signal_exit_emitter__:(g=f.__signal_exit_emitter__=new Z,g.count=0,g.emitted={}),g.infinite||(g.setMaxListeners(1/0),g.infinite=!0),dt.exports=function(e,t){if(!T(I.process))return function(){};Rr.equal(typeof e,"function","a callback must be provided for exit handler"),F===!1&&pt();var n="exit";t&&t.alwaysLast&&(n="afterexit");var r=function(){g.removeListener(n,e),g.listeners("exit").length===0&&g.listeners("afterexit").length===0&&ge()};return g.on(n,e),r};var ge=function(){!F||!T(I.process)||(F=!1,B.forEach(function(t){try{f.removeListener(t,ve[t])}catch{}}),f.emit=be,f.reallyExit=mt,g.count-=1)};A.unload=ge;var N=function(t,n,r){g.emitted[t]||(g.emitted[t]=!0,g.emit(t,n,r))},ve={};B.forEach(function(e){ve[e]=function(){if(T(I.process)){var n=f.listeners(e);n.length===g.count&&(ge(),N("exit",null,e),N("afterexit",null,e),Ar&&e==="SIGHUP"&&(e="SIGINT"),f.kill(f.pid,e))}}}),A.signals=function(){return B};var F=!1,pt=function(){F||!T(I.process)||(F=!0,g.count+=1,B=B.filter(function(t){try{return f.on(t,ve[t]),!0}catch{return!1}}),f.emit=kr,f.reallyExit=Nr)};A.load=pt;var mt=f.reallyExit,Nr=function(t){T(I.process)&&(f.exitCode=t||0,N("exit",f.exitCode,null),N("afterexit",f.exitCode,null),mt.call(f,f.exitCode))},be=f.emit,kr=function(t,n){if(t==="exit"&&T(I.process)){n!==void 0&&(f.exitCode=n);var r=be.apply(this,arguments);return N("exit",f.exitCode,null),N("afterexit",f.exitCode,null),r}else return be.apply(this,arguments)}}const jr=1e3*5,Lr=(e,t="SIGTERM",n={})=>{const r=e(t);return Br(e,t,n,r),r},Br=(e,t,n,r)=>{if(!Fr(t,n,r))return;const i=Mr(n),s=setTimeout(()=>{e("SIGKILL")},i);s.unref&&s.unref()},Fr=(e,{forceKillAfterTimeout:t},n)=>Dr(e)&&t!==!1&&n,Dr=e=>e===Ot.constants.signals.SIGTERM||typeof e=="string"&&e.toUpperCase()==="SIGTERM",Mr=({forceKillAfterTimeout:e=!0})=>{if(e===!0)return jr;if(!Number.isFinite(e)||e<0)throw new TypeError(`Expected the \`forceKillAfterTimeout\` option to be a non-negative integer, got \`${e}\` (${typeof e})`);return e},Ur=(e,t)=>{e.kill()&&(t.isCanceled=!0)},Vr=(e,t,n)=>{e.kill(t),n(Object.assign(new Error("Timed out"),{timedOut:!0,signal:t}))},Kr=(e,{timeout:t,killSignal:n="SIGTERM"},r)=>{if(t===0||t===void 0)return r;let i;const s=new Promise((a,u)=>{i=setTimeout(()=>{Vr(e,n,u)},t)}),o=r.finally(()=>{clearTimeout(i)});return Promise.race([s,o])},qr=({timeout:e})=>{if(e!==void 0&&(!Number.isFinite(e)||e<0))throw new TypeError(`Expected the \`timeout\` option to be a non-negative integer, got \`${e}\` (${typeof e})`)},Wr=async(e,{cleanup:t,detached:n},r)=>{if(!t||n)return r;const i=A(()=>{e.kill()});return r.finally(()=>{i()})};function Hr(e){return e!==null&&typeof e=="object"&&typeof e.pipe=="function"}var P={},zr={get exports(){return P},set exports(e){P=e}};const{PassThrough:Xr}=te;var Yr=e=>{e={...e};const{array:t}=e;let{encoding:n}=e;const r=n==="buffer";let i=!1;t?i=!(n||r):n=n||"utf8",r&&(n=null);const s=new Xr({objectMode:i});n&&s.setEncoding(n);let o=0;const a=[];return s.on("data",u=>{a.push(u),i?o=a.length:o+=u.length}),s.getBufferedValue=()=>t?a:r?Buffer.concat(a,o):a.join(""),s.getBufferedLength=()=>o,s};const{constants:Jr}=Gt,Qr=te,{promisify:Zr}=_t,es=Yr,ts=Zr(Qr.pipeline);class ht extends Error{constructor(){super("maxBuffer exceeded"),this.name="MaxBufferError"}}async function we(e,t){if(!e)throw new Error("Expected a stream");t={maxBuffer:1/0,...t};const{maxBuffer:n}=t,r=es(t);return await new Promise((i,s)=>{const o=a=>{a&&r.getBufferedLength()<=Jr.MAX_LENGTH&&(a.bufferedData=r.getBufferedValue()),s(a)};(async()=>{try{await ts(e,r),i()}catch(a){o(a)}})(),r.on("data",()=>{r.getBufferedLength()>n&&o(new ht)})}),r.getBufferedValue()}zr.exports=we,P.buffer=(e,t)=>we(e,{...t,encoding:"buffer"}),P.array=(e,t)=>we(e,{...t,array:!0}),P.MaxBufferError=ht;const{PassThrough:ns}=te;var rs=function(){var e=[],t=new ns({objectMode:!0});return t.setMaxListeners(0),t.add=n,t.isEmpty=r,t.on("unpipe",i),Array.prototype.slice.call(arguments).forEach(n),t;function n(s){return Array.isArray(s)?(s.forEach(n),this):(e.push(s),s.once("end",i.bind(null,s)),s.once("error",t.emit.bind(t,"error")),s.pipe(t,{end:!1}),this)}function r(){return e.length==0}function i(s){e=e.filter(function(o){return o!==s}),!e.length&&t.readable&&t.end()}};const ss=(e,t)=>{t!==void 0&&(Hr(t)?t.pipe(e.stdin):e.stdin.end(t))},is=(e,{all:t})=>{if(!t||!e.stdout&&!e.stderr)return;const n=rs();return e.stdout&&n.add(e.stdout),e.stderr&&n.add(e.stderr),n},ye=async(e,t)=>{if(!(!e||t===void 0)){e.destroy();try{return await t}catch(n){return n.bufferedData}}},$e=(e,{encoding:t,buffer:n,maxBuffer:r})=>{if(!(!e||!n))return t?P(e,{encoding:t,maxBuffer:r}):P.buffer(e,{maxBuffer:r})},os=async({stdout:e,stderr:t,all:n},{encoding:r,buffer:i,maxBuffer:s},o)=>{const a=$e(e,{encoding:r,buffer:i,maxBuffer:s}),u=$e(t,{encoding:r,buffer:i,maxBuffer:s}),l=$e(n,{encoding:r,buffer:i,maxBuffer:s*2});try{return await Promise.all([o,a,u,l])}catch(m){return Promise.all([{error:m,signal:m.signal,timedOut:m.timedOut},ye(e,a),ye(t,u),ye(n,l)])}},as=(async()=>{})().constructor.prototype,cs=["then","catch","finally"].map(e=>[e,Reflect.getOwnPropertyDescriptor(as,e)]),gt=(e,t)=>{for(const[n,r]of cs){const i=typeof t=="function"?(...s)=>Reflect.apply(r.value,t(),s):r.value.bind(t);Reflect.defineProperty(e,n,{...r,value:i})}return e},us=e=>new Promise((t,n)=>{e.on("exit",(r,i)=>{t({exitCode:r,signal:i})}),e.on("error",r=>{n(r)}),e.stdin&&e.stdin.on("error",r=>{n(r)})}),vt=(e,t=[])=>Array.isArray(t)?[e,...t]:[e],ls=/^[\w.-]+$/,ds=/"/g,fs=e=>typeof e!="string"||ls.test(e)?e:`"${e.replace(ds,'\\"')}"`,ps=(e,t)=>vt(e,t).join(" "),ms=(e,t)=>vt(e,t).map(n=>fs(n)).join(" "),hs=1e3*1e3*100,gs=({env:e,extendEnv:t,preferLocal:n,localDir:r,execPath:i})=>{const s=t?{...E.env,...e}:e;return n?cr({env:s,cwd:r,execPath:i}):s},vs=(e,t,n={})=>{const r=O._parse(e,t,n);return e=r.command,t=r.args,n=r.options,n={maxBuffer:hs,buffer:!0,stripFinalNewline:!0,extendEnv:!0,preferLocal:!1,localDir:n.cwd||E.cwd(),execPath:E.execPath,encoding:"utf8",reject:!0,cleanup:!0,all:!1,windowsHide:!0,...n},n.env=gs(n),n.stdio=Pr(n),E.platform==="win32"&&G.basename(e,".exe")==="cmd"&&t.unshift("/q"),{file:e,args:t,options:n,parsed:r}},xe=(e,t,n)=>typeof t!="string"&&!Et.isBuffer(t)?n===void 0?void 0:"":e.stripFinalNewline?or(t):t;function ee(e,t,n){const r=vs(e,t,n),i=ps(e,t),s=ms(e,t);qr(r.options);let o;try{o=_e.spawn(r.file,r.args,r.options)}catch(v){const $=new _e.ChildProcess,x=Promise.reject(lt({error:v,stdout:"",stderr:"",all:"",command:i,escapedCommand:s,parsed:r,timedOut:!1,isCanceled:!1,killed:!1}));return gt($,x)}const a=us(o),u=Kr(o,r.options,a),l=Wr(o,r.options,u),m={isCanceled:!1};o.kill=Lr.bind(null,o.kill.bind(o)),o.cancel=Ur.bind(null,o,m);const h=ot(async()=>{const[{error:v,exitCode:$,signal:x,timedOut:S},D,M,wt]=await os(o,r.options,l),Ee=xe(r.options,D),Ie=xe(r.options,M),Ce=xe(r.options,wt);if(v||$!==0||x!==null){const Oe=lt({error:v,exitCode:$,signal:x,stdout:Ee,stderr:Ie,all:Ce,command:i,escapedCommand:s,parsed:r,timedOut:S,isCanceled:m.isCanceled||(r.options.signal?r.options.signal.aborted:!1),killed:o.killed});if(!r.options.reject)return Oe;throw Oe}return{command:i,escapedCommand:s,exitCode:0,stdout:Ee,stderr:Ie,all:Ce,failed:!1,timedOut:!1,isCanceled:!1,killed:!1}});return ss(o,r.options.input),o.all=is(o,r.options),gt(o,h)}const bs="Write an insightful but concise Git commit message in a complete sentence in present tense for the following diff without prefacing it with anything:",ws=async(e,t)=>{const n=`${bs}
${t}`;if(n.length>8e3)throw new Error("The diff is too large for the OpenAI API");const r=new Rt(new At({apiKey:e}));try{return(await r.createCompletion({model:"text-davinci-003",prompt:n,temperature:.7,top_p:1,frequency_penalty:0,presence_penalty:0,max_tokens:200,stream:!1,n:3})).data.choices.filter(s=>s.text).map(s=>s.text.trim().replace(/[\n\r]/g,""))}catch(i){const s=i;throw s.message=`OpenAI API Error: ${s.message} - ${s.response.statusText}`,s}},ys=async()=>{const{stdout:e}=await ee("git",["rev-parse","--is-inside-work-tree"],{reject:!1});if(e!=="true")throw new Error("The current directory must be a Git repository!")},bt=["package-lock.json","yarn.lock","pnpm-lock.yaml"].map(e=>`:(exclude)${e}`),$s=async()=>{const e=["diff","--cached"],{stdout:t}=await ee("git",[...e,"--name-only",...bt]);if(!t)return;const{stdout:n}=await ee("git",[...e,...bt]);return{files:t.split(`
`),diff:n}},xs=e=>`Detected ${e.length.toLocaleString()} staged file${e.length>1?"s":""}`;(async()=>{if(process.argv.includes("--help")){console.log(`
		aicommits

		https://npmjs.com/package/aicommits

		Usage:
		Run \`aicommits\` for an AI generated commit message based on the staged files.
		
		Prerequisites:
		\`OPENAI_KEY\` environment variable containing the OpenAI API key (.env supported)
		`.replace(/^\t+/gm,"").trim());return}En(un(on(" aicommits ")));const{OPENAI_KEY:e}=process.env;if(!e)throw new Error("Environment variable OPENAI_KEY not found!");await ys();const t=Ve();t.start("Detecting staged files");const n=await $s();if(!n)throw new Error("No staged changes found. Make sure to stage your changes with `git add`.");t.stop(`${xs(n.files)}:
${n.files.map(u=>`     ${u}`).join(`
`)}`);const r=Ve();r.start("Generating commit messages");const i=await ws(e,n.diff);r.stop("Generated commit messages");const s=await Sn({message:`Pick a commit message to edit: ${re("(Ctrl+c to exit)")}`,options:i.map(u=>({label:u,value:u}))});if(Fe(s))return;const o=await xn({message:`Edit commit message and press Enter to commit: ${re("(Ctrl+c to exit)")}`,initial:s});if(Fe(o))return;if(!o.trim())throw new Error("Commit message cannot be empty");const{stdout:a}=await ee("git",["commit","-m",o]);Ue(`${cn("\u2714")} Successfully committed!

${re(a)}`)})().catch(e=>{Ue(`${an("\u2716")} ${e.message}`),process.exit(1)})});export default Ss();
